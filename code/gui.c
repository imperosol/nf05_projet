#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <stdbool.h>
#include <SDL2/SDL.h>
#include <SDL2/SDL_ttf.h>
#include <math.h>
#include "gui.h"

/********************************************//**
 * \file gui.c
 * \brief File that contains functions to display some features with the SDL library. Those functions can be used in any context.
 * \author Thomas Girod
 * \version 1.0
 * \date 25.11.2020
 ***********************************************/

void display_icon(SDL_Window* window)
{
    /*Icon of the window*/
    SDL_Surface *surface;
    Uint16 pixels[16*16] = {
        0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff,
        0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff,
        0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0xcc00, 0xcc00, 0xcc00, 0xcc00, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff,
        0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0xcc00, 0xcc00, 0xcc00, 0xcc00, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff,
        0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0xcc00, 0xcc00, 0xcc00, 0xcc00, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff,
        0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0xcc00, 0xcc00, 0xcc00, 0xcc00, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff,
        0x0fff, 0x0fff, 0xcc00, 0xcc00, 0xcc00, 0xcc00, 0xcc00, 0xcc00, 0xcc00, 0xcc00, 0xcc00, 0xcc00, 0xcc00, 0xcc00, 0x0fff, 0x0fff,
        0x0fff, 0x0fff, 0xcc00, 0xcc00, 0xcc00, 0xcc00, 0xcc00, 0xcc00, 0xcc00, 0xcc00, 0xcc00, 0xcc00, 0xcc00, 0xcc00, 0x0fff, 0x0fff,
        0x0fff, 0x0fff, 0xcc00, 0xcc00, 0xcc00, 0xcc00, 0xcc00, 0xcc00, 0xcc00, 0xcc00, 0xcc00, 0xcc00, 0xcc00, 0xcc00, 0x0fff, 0x0fff,
        0x0fff, 0x0fff, 0xcc00, 0xcc00, 0xcc00, 0xcc00, 0xcc00, 0xcc00, 0xcc00, 0xcc00, 0xcc00, 0xcc00, 0xcc00, 0xcc00, 0x0fff, 0x0fff,
        0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0xcc00, 0xcc00, 0xcc00, 0xcc00, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff,
        0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0xcc00, 0xcc00, 0xcc00, 0xcc00, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff,
        0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0xcc00, 0xcc00, 0xcc00, 0xcc00, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff,
        0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0xcc00, 0xcc00, 0xcc00, 0xcc00, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff,
        0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff,
        0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff, 0x0fff
    };
    surface = SDL_CreateRGBSurfaceFrom(pixels,16,16,16,16*2,0x0f00,0x00f0,0x000f,0xf000);

    SDL_SetWindowIcon(window, surface);
    SDL_FreeSurface(surface);
}

void display_text(SDL_Renderer* renderer, const char textToDisplay[], TTF_Font* p_font, SDL_Color text_color, const unsigned int positionX, const unsigned int positionY)
{
    SDL_Rect r;
    r.x = positionX;
    r.y = positionY;
    SDL_Surface* pageText = TTF_RenderText_Solid(p_font, textToDisplay, text_color);
    SDL_Texture* texture = SDL_CreateTextureFromSurface(renderer,pageText);
    SDL_QueryTexture(texture,NULL,NULL,&r.w,&r.h);
    //printf("%s\t: %d\n", textToDisplay, r.w);

    SDL_RenderCopy(renderer,texture,NULL,&r);

    SDL_FreeSurface(pageText);
    SDL_DestroyTexture(texture);
}

void display_underlined_text(SDL_Renderer* renderer, const char textToDisplay[], TTF_Font* p_font, SDL_Color text_color, const unsigned int positionX, const unsigned int positionY)
{
    SDL_Rect r;
    r.x = positionX;
    r.y = positionY;
    SDL_Surface* pageText = TTF_RenderText_Solid(p_font, textToDisplay, text_color);
    SDL_Texture* texture = SDL_CreateTextureFromSurface(renderer,pageText);
    SDL_QueryTexture(texture,NULL,NULL,&r.w,&r.h);

    SDL_RenderCopy(renderer,texture,NULL,&r);
    SDL_RenderDrawLine(renderer,r.x, r.y+r.h, r.x + r.w, r.y+r.h);

    SDL_FreeSurface(pageText);
    SDL_DestroyTexture(texture);
}

void hide_text(SDL_Renderer* renderer, const char textToHide[], const int xPosition, const int yPosition, SDL_Color text_color, TTF_Font* font)
{
    SDL_Rect rect;
    rect.x = xPosition;
    rect.y = yPosition;
    SDL_Surface* pageText = TTF_RenderText_Solid(font, textToHide, text_color);
    SDL_Texture* texture = SDL_CreateTextureFromSurface(renderer,pageText);
    SDL_QueryTexture(texture,NULL,NULL,&rect.w,&rect.h);

    SDL_RenderFillRect(renderer, &rect);
}

void convert_minutes_to_displayable_hour(int minutes, char str_time[])
{
    int hours;
    hours = minutes/60;
    minutes = minutes%60;
    convert_hh_mm_to_displayable_hour(hours, minutes, str_time);
}

void convert_hh_mm_to_displayable_hour(int hours, int minutes, char str_time[])
{
    str_time[0] = hours/10 + '0';
    str_time[1] = hours%10 + '0';
    str_time[3] = minutes/10 + '0';
    str_time[4] = minutes%10 + '0';
}
